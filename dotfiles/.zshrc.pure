# Pure prompt-based zshrc for macOS
# Minimal, fast, git-focused (no jj support without forking)
#
# INSTALL (run these once):
#   brew install pure
#   brew install atuin        # (if you want to keep atuin)
#   # Copy this file: cp ~/.zshrc.pure ~/.zshrc
#
# ---------------------------------------------------------

# History
HISTFILE=~/.zsh_history
HISTSIZE=9001
SAVEHIST=9001
setopt BANG_HIST
setopt INC_APPEND_HISTORY
setopt SHARE_HISTORY
setopt HIST_EXPIRE_DUPS_FIRST
setopt HIST_IGNORE_DUPS
setopt HIST_FIND_NO_DUPS
setopt HIST_IGNORE_SPACE
setopt HIST_REDUCE_BLANKS
setopt HIST_VERIFY

# Editor
export EDITOR="vim"
export GIT_EDITOR="vim"

# Useful aliases
alias lt='du -sh * | sort -h'
alias ls='ls -G'
alias la='ls -la'
alias ll='ls -l'

# ---------------------------------------------------------
# Completions
# ---------------------------------------------------------
autoload -Uz compinit
if [[ -n ${ZDOTDIR}/.zcompdump(#qN.mh+24) ]]; then
  compinit
else
  compinit -C
fi

zstyle ':completion:*' matcher-list 'm:{a-zA-Z-_}={A-Za-z_-}' 'r:|=*' 'l:|=* r:|=*'
zstyle ':completion:*' menu select

# ---------------------------------------------------------
# Keybindings
# ---------------------------------------------------------
bindkey -e
bindkey '^P' history-beginning-search-backward
bindkey '^N' history-beginning-search-forward
bindkey '^[[A' history-beginning-search-backward
bindkey '^[[B' history-beginning-search-forward

# ---------------------------------------------------------
# Pure prompt setup
# ---------------------------------------------------------
fpath+=("$(brew --prefix)/share/zsh/site-functions")
autoload -U promptinit; promptinit
prompt pure

# Pure customization (optional)
# Show command execution time for commands > 5 seconds (default)
PURE_CMD_MAX_EXEC_TIME=2

# Disable git fetch (if you want faster prompt in large repos)
# PURE_GIT_PULL=0

# Custom prompt symbol if you want
# PURE_PROMPT_SYMBOL="â¯"

# Colors via zstyle
# zstyle ':prompt:pure:path' color blue
# zstyle ':prompt:pure:git:branch' color magenta
# zstyle ':prompt:pure:git:dirty' color red

# ---------------------------------------------------------
# Tool initialization
# ---------------------------------------------------------

# NVM (lazy-load)
export NVM_DIR="$HOME/.nvm"
nvm() {
  unset -f nvm node npm npx
  [ -s "/usr/local/opt/nvm/nvm.sh" ] && \. "/usr/local/opt/nvm/nvm.sh"
  [ -s "/usr/local/opt/nvm/etc/bash_completion.d/nvm" ] && \. "/usr/local/opt/nvm/etc/bash_completion.d/nvm"
  nvm "$@"
}
node() { nvm use default >/dev/null 2>&1; command node "$@"; }
npm() { nvm use default >/dev/null 2>&1; command npm "$@"; }
npx() { nvm use default >/dev/null 2>&1; command npx "$@"; }

# Bun
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"
[ -s "$HOME/.bun/_bun" ] && source "$HOME/.bun/_bun"

# Terraform
autoload -U +X bashcompinit && bashcompinit
[[ -f /usr/local/bin/terraform ]] && complete -o nospace -C /usr/local/bin/terraform terraform

# Google Cloud SDK
[ -f "$HOME/google-cloud-sdk/path.zsh.inc" ] && . "$HOME/google-cloud-sdk/path.zsh.inc"
[ -f "$HOME/google-cloud-sdk/completion.zsh.inc" ] && . "$HOME/google-cloud-sdk/completion.zsh.inc"

# Atuin
[ -f "$HOME/.atuin/bin/env" ] && . "$HOME/.atuin/bin/env"
command -v atuin &>/dev/null && eval "$(atuin init zsh)"

# Claude CLI
alias claude="$HOME/.claude/local/claude"

# Uv/rye
[ -f "$HOME/.local/bin/env" ] && . "$HOME/.local/bin/env"
